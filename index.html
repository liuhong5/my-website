<!DOCTYPE html>
<html lang="zh-CN">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>花朵成长记</title>
  <script src="https://cdn.tailwindcss.com"></script>
  <link href="https://cdn.jsdelivr.net/npm/font-awesome@4.7.0/css/font-awesome.min.css" rel="stylesheet">
  <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700&display=swap" rel="stylesheet">
  
  <!-- 配置Tailwind -->
  <script>
    tailwind.config = {
      theme: {
        extend: {
          colors: {
            primary: '#4ade80',
            secondary: '#818cf8',
            accent: '#f97316',
            neutral: '#f8fafc',
            dark: '#334155'
          },
          fontFamily: {
            inter: ['Inter', 'sans-serif'],
          },
        },
      }
    }
  </script>
  
  <style type="text/tailwindcss">
    @layer utilities {
      .content-auto {
        content-visibility: auto;
      }
      .flower-pot {
        border-radius: 0 0 2rem 2rem;
      }
      .petal {
        border-radius: 100% 0;
        transform-origin: bottom right;
      }
      .btn-bounce {
        transition: transform 0.2s ease;
      }
      .btn-bounce:active {
        transform: scale(0.95);
      }
      .grow-animation {
        animation: grow 0.5s ease-out forwards;
      }
      .fade-in {
        animation: fadeIn 0.3s ease-in forwards;
      }
      @keyframes grow {
        0% { transform: scale(1); }
        50% { transform: scale(1.1); }
        100% { transform: scale(1); }
      }
      @keyframes fadeIn {
        from { opacity: 0; }
        to { opacity: 1; }
      }
    }
  </style>
</head>
<body class="font-inter bg-gradient-to-br from-green-50 to-blue-50 min-h-screen text-dark">
  <!-- 顶部导航 -->
  <header class="bg-white/80 backdrop-blur-md shadow-sm fixed top-0 left-0 right-0 z-50 transition-all duration-300">
    <div class="container mx-auto px-4 py-3 flex justify-between items-center">
      <div class="flex items-center gap-2">
        <i class="fa fa-leaf text-primary text-2xl"></i>
        <h1 class="text-xl font-semibold text-dark">花朵成长记</h1>
      </div>
      <nav class="flex gap-4">
        <button id="flowerBtn" class="px-3 py-1.5 rounded-md bg-primary/10 text-primary font-medium hover:bg-primary/20 transition">
          <i class="fa fa-pagelines mr-1"></i>我的花
        </button>
        <button id="wreathBtn" class="px-3 py-1.5 rounded-md bg-white text-dark font-medium hover:bg-gray-100 transition">
          <i class="fa fa-th mr-1"></i>花圈
        </button>
        <button id="rankingBtn" class="px-3 py-1.5 rounded-md bg-white text-dark font-medium hover:bg-gray-100 transition">
          <i class="fa fa-trophy mr-1"></i>排行榜
        </button>
        <button id="editorBtn" class="px-3 py-1.5 rounded-md bg-white text-dark font-medium hover:bg-gray-100 transition">
          <i class="fa fa-key mr-1"></i>编辑员
        </button>
      </nav>
    </div>
  </header>

  <!-- 主内容区 -->
  <main class="container mx-auto px-4 pt-24 pb-16">
    <!-- 花朵管理区域 -->
    <section id="flowerSection" class="fade-in">
      <div class="max-w-6xl mx-auto">
        <div class="flex flex-col md:flex-row gap-6">
          <!-- 左侧花朵列表 -->
          <div class="w-full md:w-1/4">
            <div class="bg-white rounded-xl shadow-md p-5">
              <h3 class="text-lg font-semibold mb-3">花朵列表</h3>
              <div class="mb-3 editor-only">
                <input type="text" id="flowerSearch" placeholder="搜索花朵..." 
                      class="w-full px-3 py-2 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-primary/50 focus:border-primary text-sm">
              </div>
              <div id="allFlowersList" class="space-y-2 max-h-[calc(100vh-240px)] overflow-y-auto pr-2">
                <!-- 花朵名称列表将通过JS动态生成 -->
              </div>
            </div>
          </div>
          
          <!-- 右侧花朵详情 -->
          <div class="w-full md:w-3/4">
            <!-- 花朵管理工具栏 -->
            <div class="bg-white rounded-xl shadow-md p-5 mb-6 flex justify-between items-center">
              <h2 class="text-lg font-semibold">我的花朵们</h2>
              <button id="addFlowerBtn" class="px-4 py-2 bg-primary text-white rounded-lg hover:bg-primary/90 transition btn-bounce flex items-center gap-1 editor-only hidden">
                <i class="fa fa-plus"></i>
                <span>添加新花</span>
              </button>
            </div>
            
            <!-- 当前选中花朵详情 -->
            <div class="bg-white rounded-xl shadow-md p-6">
              <h3 id="displayFlowerName" class="text-xl font-medium mb-4">请选择一朵花</h3>
              <div class="flex justify-center items-end mb-4 h-64">
                <div id="flowerContainer" class="relative">
                  <!-- 花盆 -->
                  <div class="flower-pot w-24 h-16 bg-amber-700 mx-auto"></div>
                  
                  <!-- 花茎 -->
                  <div id="stem" class="w-2 h-16 bg-green-600 mx-auto -mt-1"></div>
                  
                  <!-- 花朵 -->
                  <div id="flower" class="relative -mt-1">
                    <!-- 花瓣将通过JS动态生成 -->
                  </div>
                </div>
              </div>
              
              <!-- 花朵操作 -->
              <div class="flex flex-col sm:flex-row gap-3 justify-center mb-4 editor-only hidden">
                <div class="flex gap-3 w-full sm:w-auto">
                  <input type="text" id="flowerName" placeholder="输入花的名字..." 
                        class="flex-1 px-4 py-2 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-primary/50 focus:border-primary">
                  <button id="saveNameBtn" class="px-5 py-2 bg-primary text-white rounded-lg hover:bg-primary/90 transition btn-bounce" disabled>
                    保存名称
                  </button>
                </div>
                <div class="flex gap-3 w-full sm:w-auto justify-center sm:justify-start">
                  <button id="waterBtn" class="px-6 py-2 bg-blue-500 text-white rounded-full shadow-md hover:bg-blue-600 transition btn-bounce flex items-center gap-2" disabled>
                    <i class="fa fa-tint"></i>
                    <span>浇花</span>
                  </button>
                  <button id="deleteFlowerBtn" class="px-6 py-2 bg-red-500 text-white rounded-full shadow-md hover:bg-red-600 transition btn-bounce flex items-center gap-2" disabled>
                    <i class="fa fa-trash"></i>
                    <span>删除</span>
                  </button>
                </div>
              </div>
              
              <!-- 浇花次数 -->
              <div class="mt-4 text-gray-600 text-center">
                <span>已浇水: </span>
                <span id="waterCount" class="font-semibold text-primary">0</span>
                <span> 次</span>
              </div>
              
              <!-- 成长记录 -->
              <div class="mt-6">
                <h3 class="text-lg font-semibold mb-4">成长记录</h3>
                <div id="growthLog" class="space-y-2 max-h-40 overflow-y-auto pr-2">
                  <p class="text-gray-500 text-center italic">请选择一朵花查看记录</p>
                </div>
              </div>
            </div>
          </div>
        </div>
      </div>
    </section>
    
    <!-- 花圈管理区域 -->
    <section id="wreathSection" class="hidden fade-in">
      <div class="max-w-4xl mx-auto">
        <div class="bg-white rounded-xl shadow-md p-6 mb-6">
          <h2 class="text-lg font-semibold mb-4">我的花圈</h2>
          
          <!-- 花圈选择 -->
          <div class="mb-6">
            <div class="flex gap-3 mb-3 editor-only hidden">
              <input type="text" id="wreathName" placeholder="输入花圈名称..." 
                    class="flex-1 px-4 py-2 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-secondary/50 focus:border-secondary">
              <button id="addWreathBtn" class="px-5 py-2 bg-secondary text-white rounded-lg hover:bg-secondary/90 transition btn-bounce">
                添加花圈
              </button>
            </div>
            
            <div id="wreathList" class="flex flex-wrap gap-2">
              <!-- 花圈选项将通过JS动态生成 -->
            </div>
          </div>
          
          <!-- 花圈内容 -->
          <div id="currentWreathContainer" class="border border-gray-200 rounded-lg p-4">
            <div class="flex justify-between items-center mb-3">
              <h3 id="currentWreathName" class="font-medium text-secondary">请选择一个花圈</h3>
              <button id="deleteWreathBtn" class="px-3 py-1 bg-red-500/10 text-red-500 rounded-lg hover:bg-red-500/20 transition btn-bounce text-sm editor-only hidden">
                <i class="fa fa-trash mr-1"></i>删除花圈
              </button>
            </div>
            
            <!-- 花圈分数操作 -->
            <div class="mb-4 editor-only hidden">
              <div class="flex flex-col sm:flex-row gap-3 mb-4">
                <input type="number" id="wreathScoreToAdd" placeholder="添加分数..." min="1" 
                      class="flex-1 px-4 py-2 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-secondary/50 focus:border-secondary">
                <input type="datetime-local" id="scoreDateTime" class="px-4 py-2 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-secondary/50 focus:border-secondary">
                <button id="addScoreToWreathBtn" class="px-5 py-2 bg-secondary/80 text-white rounded-lg hover:bg-secondary transition btn-bounce" disabled>
                  添加分数
                </button>
              </div>
              
              <!-- 添加花朵到花圈 -->
              <select id="flowerToAdd" class="w-full px-4 py-2 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-secondary/50 focus:border-secondary mb-3">
                <option value="">选择要添加的花...</option>
              </select>
              
              <button id="addFlowerToWreathBtn" class="px-5 py-2 bg-secondary/80 text-white rounded-lg hover:bg-secondary transition btn-bounce" disabled>
                添加到花圈
              </button>
            </div>
            
            <!-- 花圈中的花朵列表 -->
            <div>
              <h4 class="font-medium mb-2">花圈中的花朵</h4>
              <div id="flowersInWreath" class="space-y-2 max-h-32 overflow-y-auto pr-2">
                <p class="text-gray-500 text-center italic">花圈为空</p>
              </div>
              
              <!-- 分数记录 -->
              <div class="mt-4">
                <h4 class="font-medium mb-2">分数记录</h4>
                <div id="scoreLog" class="space-y-2 max-h-32 overflow-y-auto pr-2">
                  <p class="text-gray-500 text-center italic">暂无分数记录</p>
                </div>
              </div>
              
              <!-- 分数统计 -->
              <div class="mt-4 pt-4 border-t border-gray-100">
                <div class="flex justify-between items-center">
                  <span class="font-medium">花朵数量:</span>
                  <span id="flowerCountInWreath" class="text-lg font-semibold text-accent">0</span>
                </div>
              </div>
            </div>
          </div>
        </div>
      </div>
    </section>
    
    <!-- 排行榜区域 -->
    <section id="rankingSection" class="hidden fade-in">
      <div class="max-w-4xl mx-auto">
        <div class="bg-white rounded-xl shadow-md p-6 mb-6">
          <h2 class="text-lg font-semibold mb-6">排行榜与统计</h2>
          
          <div class="grid grid-cols-1 md:grid-cols-2 gap-6">
            <!-- 花朵排名 -->
            <div>
              <h3 class="text-md font-medium mb-4 flex items-center">
                <i class="fa fa-trophy text-yellow-500 mr-2"></i>
                花朵浇水次数排名
              </h3>
              <div id="flowerRanking" class="space-y-3 max-h-96 overflow-y-auto pr-2">
                <!-- 排名将通过JS动态生成 -->
              </div>
            </div>
            
            <!-- 花圈统计 -->
            <div>
              <h3 class="text-md font-medium mb-4 flex items-center">
                <i class="fa fa-bar-chart text-secondary mr-2"></i>
                花圈统计
              </h3>
              <div id="wreathStats" class="space-y-3 max-h-96 overflow-y-auto pr-2">
                <!-- 花圈统计将通过JS动态生成 -->
              </div>
            </div>
          </div>
        </div>
      </div>
    </section>
  </main>

  <!-- 页脚 -->
  <footer class="bg-white/80 backdrop-blur-md py-4 text-center text-gray-500 text-sm">
    <p>花朵成长记 &copy; 2023 - 记录每一次成长</p>
  </footer>

  <!-- 编辑员权限模态框 -->
  <div id="editorModal" class="fixed inset-0 bg-black/50 flex items-center justify-center z-50 hidden">
    <div class="bg-white rounded-xl p-6 w-full max-w-md">
      <h3 class="text-xl font-semibold mb-4">编辑员认证</h3>
      <p class="text-gray-600 mb-4">请输入编辑员密码以获取权限</p>
      <div class="mb-4">
        <input type="password" id="editorPassword" placeholder="输入编辑员密码..." 
              class="w-full px-4 py-2 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-primary/50 focus:border-primary">
      </div>
      <div class="flex gap-3">
        <button id="cancelEditorBtn" class="flex-1 px-4 py-2 border border-gray-300 text-gray-700 rounded-lg hover:bg-gray-50 transition">
          取消
        </button>
        <button id="confirmEditorBtn" class="flex-1 px-4 py-2 bg-primary text-white rounded-lg hover:bg-primary/90 transition">
          确认
        </button>
      </div>
    </div>
  </div>

  <script>
    // 数据模型
    const appData = {
      flowers: [{
        id: 1,
        name: '我的小花',
        waterCount: 0,
        growthLog: []
      }],
      wreaths: [],
      currentFlowerId: 1,
      currentWreathId: null,
      isEditor: false, // 编辑员状态
      
      // 保存数据到本地存储
      saveData() {
        localStorage.setItem('flowerAppData', JSON.stringify(this));
      },
      
      // 从本地存储加载数据
      loadData() {
        const savedData = localStorage.getItem('flowerAppData');
        if (savedData) {
          const parsedData = JSON.parse(savedData);
          Object.assign(this, parsedData);
        }
      },
      
      // 添加新花
      addNewFlower() {
        const newFlower = {
          id: this.generateId(),
          name: `新花${this.flowers.length + 1}`,
          waterCount: 0,
          growthLog: []
        };
        this.flowers.push(newFlower);
        this.currentFlowerId = newFlower.id;
        this.saveData();
        return newFlower;
      },
      
      // 删除花朵
      deleteFlower(flowerId) {
        // 从花朵列表中删除
        this.flowers = this.flowers.filter(flower => flower.id !== flowerId);
        
        // 从所有花圈中移除该花朵
        this.wreaths.forEach(wreath => {
          wreath.flowers = wreath.flowers.filter(item => item.flowerId !== flowerId);
        });
        
        // 更新当前选中的花朵
        if (this.currentFlowerId === flowerId) {
          this.currentFlowerId = this.flowers.length > 0 ? this.flowers[0].id : null;
        }
        
        this.saveData();
      },
      
      // 添加新花圈
      addNewWreath(name) {
        const newWreath = {
          id: this.generateId(),
          name,
          flowers: [],
          scoreLogs: [] // 分数记录，包含时间
        };
        this.wreaths.push(newWreath);
        this.currentWreathId = newWreath.id;
        this.saveData();
        return newWreath;
      },
      
      // 删除花圈
      deleteWreath(wreathId) {
        this.wreaths = this.wreaths.filter(wreath => wreath.id !== wreathId);
        
        if (this.currentWreathId === wreathId) {
          this.currentWreathId = this.wreaths.length > 0 ? this.wreaths[0].id : null;
        }
        
        this.saveData();
      },
      
      // 给花圈加分
      addScoreToWreath(score, dateTime) {
        const wreath = this.wreaths.find(w => w.id === this.currentWreathId);
        if (wreath) {
          // 确保分数记录数组存在
          if (!wreath.scoreLogs) wreath.scoreLogs = [];
          
          // 记录分数和时间
          const logId = this.generateId();
          wreath.scoreLogs.push({
            id: logId,
            score,
            dateTime: dateTime || new Date().toISOString()
          });
          
          this.saveData();
          return {wreath, logId};
        }
        return null;
      },
      
      // 从花圈中删除分数记录
      deleteScoreFromWreath(logId) {
        const wreath = this.wreaths.find(w => w.id === this.currentWreathId);
        if (wreath && wreath.scoreLogs) {
          // 从记录列表中删除
          wreath.scoreLogs = wreath.scoreLogs.filter(log => log.id !== logId);
          this.saveData();
          return true;
        }
        return false;
      },
      
      // 添加花朵到花圈
      addFlowerToWreath(flowerId) {
        const wreath = this.wreaths.find(w => w.id === this.currentWreathId);
        const flower = this.flowers.find(f => f.id === flowerId);
        
        if (wreath && flower) {
          // 检查花朵是否已在花圈中
          const alreadyExists = wreath.flowers.some(item => item.flowerId === flowerId);
          if (!alreadyExists) {
            wreath.flowers.push({
              id: this.generateId(),
              flowerId: flower.id
            });
            this.saveData();
            return true;
          }
        }
        return false;
      },
      
      // 生成唯一ID
      generateId() {
        return Date.now().toString(36) + Math.random().toString(36).substr(2, 5);
      },
      
      // 验证编辑员密码
      verifyEditorPassword(password) {
        this.isEditor = password === 'yy666';
        this.saveData();
        return this.isEditor;
      }
    };

    // DOM元素
    const elements = {
      // 导航按钮
      flowerBtn: document.getElementById('flowerBtn'),
      wreathBtn: document.getElementById('wreathBtn'),
      rankingBtn: document.getElementById('rankingBtn'),
      editorBtn: document.getElementById('editorBtn'),
      
      // 区域
      flowerSection: document.getElementById('flowerSection'),
      wreathSection: document.getElementById('wreathSection'),
      rankingSection: document.getElementById('rankingSection'),
      
      // 花朵管理
      allFlowersList: document.getElementById('allFlowersList'),
      flowerSearch: document.getElementById('flowerSearch'),
      addFlowerBtn: document.getElementById('addFlowerBtn'),
      displayFlowerName: document.getElementById('displayFlowerName'),
      flowerName: document.getElementById('flowerName'),
      saveNameBtn: document.getElementById('saveNameBtn'),
      waterBtn: document.getElementById('waterBtn'),
      deleteFlowerBtn: document.getElementById('deleteFlowerBtn'),
      waterCount: document.getElementById('waterCount'),
      growthLog: document.getElementById('growthLog'),
      flowerContainer: document.getElementById('flowerContainer'),
      stem: document.getElementById('stem'),
      flower: document.getElementById('flower'),
      
      // 花圈管理
      wreathName: document.getElementById('wreathName'),
      addWreathBtn: document.getElementById('addWreathBtn'),
      wreathList: document.getElementById('wreathList'),
      currentWreathName: document.getElementById('currentWreathName'),
      deleteWreathBtn: document.getElementById('deleteWreathBtn'),
      wreathScoreToAdd: document.getElementById('wreathScoreToAdd'),
      scoreDateTime: document.getElementById('scoreDateTime'),
      addScoreToWreathBtn: document.getElementById('addScoreToWreathBtn'),
      flowerToAdd: document.getElementById('flowerToAdd'),
      addFlowerToWreathBtn: document.getElementById('addFlowerToWreathBtn'),
      flowersInWreath: document.getElementById('flowersInWreath'),
      scoreLog: document.getElementById('scoreLog'),
      flowerCountInWreath: document.getElementById('flowerCountInWreath'),
      
      // 排行榜
      flowerRanking: document.getElementById('flowerRanking'),
      wreathStats: document.getElementById('wreathStats'),
      
      // 编辑员模态框
      editorModal: document.getElementById('editorModal'),
      editorPassword: document.getElementById('editorPassword'),
      cancelEditorBtn: document.getElementById('cancelEditorBtn'),
      confirmEditorBtn: document.getElementById('confirmEditorBtn')
    };

    // 渲染函数
    const render = {
      // 初始化应用
      init() {
        appData.loadData();
        this.updateEditorUI();
        this.renderFlowerList();
        this.renderFlowerDetails();
        this.renderWreathList();
        this.renderWreathDetails();
        this.renderRankings();
        this.setupEventListeners();
      },
      
      // 更新编辑员UI
      updateEditorUI() {
        const editorElements = document.querySelectorAll('.editor-only');
        editorElements.forEach(el => {
          el.classList.toggle('hidden', !appData.isEditor);
        });
      },
      
      // 渲染花朵列表
      renderFlowerList() {
        const { allFlowersList, flowerSearch } = elements;
        allFlowersList.innerHTML = '';
        
        // 获取搜索词
        const searchTerm = (flowerSearch.value || '').toLowerCase();
        
        // 过滤花朵
        const filteredFlowers = appData.flowers.filter(flower => 
          flower.name.toLowerCase().includes(searchTerm)
        );
        
        if (filteredFlowers.length === 0) {
          allFlowersList.innerHTML = '<p class="text-gray-500 text-center italic text-sm">没有找到花朵</p>';
          return;
        }
        
        // 渲染花朵列表
        filteredFlowers.forEach(flower => {
          const flowerEl = document.createElement('div');
          flowerEl.className = `px-3 py-2 rounded-md cursor-pointer transition ${
            appData.currentFlowerId === flower.id 
              ? 'bg-primary/10 text-primary font-medium' 
              : 'hover:bg-gray-100'
          }`;
          flowerEl.textContent = flower.name;
          flowerEl.addEventListener('click', () => {
            appData.currentFlowerId = flower.id;
            this.renderFlowerList();
            this.renderFlowerDetails();
          });
          allFlowersList.appendChild(flowerEl);
        });
      },
      
      // 渲染花朵详情
      renderFlowerDetails() {
        const { 
          displayFlowerName, flowerName, saveNameBtn, 
          waterBtn, deleteFlowerBtn, waterCount, 
          growthLog, stem, flower
        } = elements;
        
        const currentFlower = appData.flowers.find(f => f.id === appData.currentFlowerId);
        
        if (!currentFlower) {
          displayFlowerName.textContent = '请选择一朵花';
          flowerName.value = '';
          saveNameBtn.disabled = true;
          waterBtn.disabled = true;
          deleteFlowerBtn.disabled = true;
          waterCount.textContent = '0';
          growthLog.innerHTML = '<p class="text-gray-500 text-center italic">请选择一朵花查看记录</p>';
          this.renderFlowerVisual(0);
          return;
        }
        
        // 更新UI
        displayFlowerName.textContent = currentFlower.name;
        flowerName.value = currentFlower.name;
        saveNameBtn.disabled = false;
        waterBtn.disabled = false;
        deleteFlowerBtn.disabled = false;
        waterCount.textContent = currentFlower.waterCount;
        
        // 渲染成长记录
        this.renderGrowthLog(currentFlower.growthLog);
        
        // 渲染花朵视觉效果
        this.renderFlowerVisual(currentFlower.waterCount);
      },
      
      // 渲染花朵视觉效果
      renderFlowerVisual(waterCount) {
        const { stem, flower } = elements;
        
        // 根据浇水次数调整花茎长度
        const stemHeight = 16 + Math.min(waterCount * 2, 40); // 最大增加40px
        stem.style.height = `${stemHeight}px`;
        
        // 清除现有花瓣
        flower.innerHTML = '';
        
        // 根据浇水次数生成花瓣
        const petalCount = Math.min(Math.floor(waterCount / 2) + 3, 12); // 最少3瓣，最多12瓣
        const colors = ['#f472b6', '#ec4899', '#db2777', '#be185d', '#9d174d'];
        const colorIndex = Math.min(Math.floor(waterCount / 5), colors.length - 1);
        const petalColor = colors[colorIndex];
        
        for (let i = 0; i < petalCount; i++) {
          const petal = document.createElement('div');
          const size = 10 + Math.min(waterCount, 20); // 花瓣大小随浇水次数增加
          const angle = (i * (360 / petalCount));
          
          petal.className = 'petal absolute';
          petal.style.width = `${size}px`;
          petal.style.height = `${size}px`;
          petal.style.backgroundColor = petalColor;
          petal.style.transform = `rotate(${angle}deg)`;
          petal.style.bottom = '0';
          petal.style.right = '0';
          
          flower.appendChild(petal);
        }
        
        // 添加花心
        if (petalCount > 0) {
          const center = document.createElement('div');
          center.className = 'absolute rounded-full bg-yellow-300';
          center.style.width = '8px';
          center.style.height = '8px';
          center.style.bottom = '0';
          center.style.right = '0';
          flower.appendChild(center);
        }
      },
      
      // 渲染成长记录
      renderGrowthLog(logs) {
        const { growthLog } = elements;
        
        if (logs.length === 0) {
          growthLog.innerHTML = '<p class="text-gray-500 text-center italic">暂无成长记录</p>';
          return;
        }
        
        growthLog.innerHTML = '';
        // 按时间倒序排列
        const sortedLogs = [...logs].sort((a, b) => new Date(b.timestamp) - new Date(a.timestamp));
        
        sortedLogs.forEach(log => {
          const logEl = document.createElement('div');
          logEl.className = 'p-2 bg-gray-50 rounded-md text-sm';
          
          const date = new Date(log.timestamp);
          const formattedDate = date.toLocaleString();
          
          logEl.innerHTML = `
            <div class="flex justify-between">
              <span>${log.action}</span>
              <span class="text-gray-500">${formattedDate}</span>
            </div>
          `;
          growthLog.appendChild(logEl);
        });
      },
      
      // 渲染花圈列表
      renderWreathList() {
        const { wreathList } = elements;
        wreathList.innerHTML = '';
        
        if (appData.wreaths.length === 0) {
          wreathList.innerHTML = '<p class="text-gray-500 text-sm">暂无花圈，请添加</p>';
          return;
        }
        
        appData.wreaths.forEach(wreath => {
          const wreathEl = document.createElement('div');
          wreathEl.className = `px-3 py-1.5 rounded-full text-sm cursor-pointer transition ${
            appData.currentWreathId === wreath.id 
              ? 'bg-secondary/10 text-secondary font-medium' 
              : 'bg-gray-100 hover:bg-gray-200'
          }`;
          wreathEl.textContent = wreath.name;
          wreathEl.addEventListener('click', () => {
            appData.currentWreathId = wreath.id;
            this.renderWreathList();
            this.renderWreathDetails();
          });
          wreathList.appendChild(wreathEl);
        });
      },
      
      // 渲染花圈详情
      renderWreathDetails() {
        const { 
          currentWreathName, deleteWreathBtn, 
          addScoreToWreathBtn, addFlowerToWreathBtn,
          flowersInWreath, scoreLog, flowerCountInWreath,
          flowerToAdd
        } = elements;
        
        const currentWreath = appData.wreaths.find(w => w.id === appData.currentWreathId);
        
        // 重置添加花朵的下拉框
        flowerToAdd.innerHTML = '<option value="">选择要添加的花...</option>';
        appData.flowers.forEach(flower => {
          const option = document.createElement('option');
          option.value = flower.id;
          option.textContent = flower.name;
          flowerToAdd.appendChild(option);
        });
        
        if (!currentWreath) {
          currentWreathName.textContent = '请选择一个花圈';
          deleteWreathBtn.disabled = true;
          addScoreToWreathBtn.disabled = true;
          addFlowerToWreathBtn.disabled = true;
          flowersInWreath.innerHTML = '<p class="text-gray-500 text-center italic">花圈为空</p>';
          scoreLog.innerHTML = '<p class="text-gray-500 text-center italic">暂无分数记录</p>';
          flowerCountInWreath.textContent = '0';
          return;
        }
        
        // 更新UI
        currentWreathName.textContent = currentWreath.name;
        deleteWreathBtn.disabled = false;
        addScoreToWreathBtn.disabled = false;
        addFlowerToWreathBtn.disabled = false;
        
        // 渲染花圈中的花朵
        this.renderFlowersInWreath(currentWreath.flowers);
        
        // 渲染分数记录
        this.renderScoreLog(currentWreath.scoreLogs || []);
        
        // 更新花朵数量
        flowerCountInWreath.textContent = currentWreath.flowers.length;
      },
      
      // 渲染花圈中的花朵
      renderFlowersInWreath(flowersInWreath) {
        const { flowersInWreath: container } = elements;
        
        if (flowersInWreath.length === 0) {
          container.innerHTML = '<p class="text-gray-500 text-center italic">花圈为空</p>';
          return;
        }
        
        container.innerHTML = '';
        
        flowersInWreath.forEach(item => {
          const flower = appData.flowers.find(f => f.id === item.flowerId);
          if (!flower) return;
          
          const flowerEl = document.createElement('div');
          flowerEl.className = 'p-2 bg-gray-50 rounded-md flex justify-between items-center';
          
          flowerEl.innerHTML = `
            <span>${flower.name}</span>
            ${appData.isEditor ? `
              <button class="text-red-500 hover:text-red-700 transition delete-flower-from-wreath" 
                      data-id="${item.id}">
                <i class="fa fa-times"></i>
              </button>
            ` : ''}
          `;
          
          container.appendChild(flowerEl);
        });
        
        // 添加删除事件监听
        if (appData.isEditor) {
          document.querySelectorAll('.delete-flower-from-wreath').forEach(btn => {
            btn.addEventListener('click', (e) => {
              const itemId = e.currentTarget.dataset.id;
              const currentWreath = appData.wreaths.find(w => w.id === appData.currentWreathId);
              
              if (currentWreath) {
                currentWreath.flowers = currentWreath.flowers.filter(item => item.id !== itemId);
                appData.saveData();
                this.renderWreathDetails();
              }
            });
          });
        }
      },
      
      // 渲染分数记录
      renderScoreLog(scoreLogs) {
        const { scoreLog } = elements;
        
        if (scoreLogs.length === 0) {
          scoreLog.innerHTML = '<p class="text-gray-500 text-center italic">暂无分数记录</p>';
          return;
        }
        
        scoreLog.innerHTML = '';
        // 按时间倒序排列
        const sortedLogs = [...scoreLogs].sort((a, b) => new Date(b.dateTime) - new Date(a.dateTime));
        
        sortedLogs.forEach(log => {
          const logEl = document.createElement('div');
          logEl.className = 'p-2 bg-gray-50 rounded-md flex justify-between items-center';
          
          const date = new Date(log.dateTime);
          const formattedDate = date.toLocaleString();
          
          logEl.innerHTML = `
            <div>
              <span class="font-medium text-secondary">+${log.score}</span>
              <span class="text-gray-500 text-sm ml-2">${formattedDate}</span>
            </div>
            ${appData.isEditor ? `
              <button class="text-red-500 hover:text-red-700 transition delete-score" 
                      data-id="${log.id}">
                <i class="fa fa-times"></i>
              </button>
            ` : ''}
          `;
          
          scoreLog.appendChild(logEl);
        });
        
        // 添加删除事件监听
        if (appData.isEditor) {
          document.querySelectorAll('.delete-score').forEach(btn => {
            btn.addEventListener('click', (e) => {
              const logId = e.currentTarget.dataset.id;
              appData.deleteScoreFromWreath(logId);
              this.renderWreathDetails();
            });
          });
        }
      },
      
      // 渲染排行榜
      renderRankings() {
        this.renderFlowerRanking();
        this.renderWreathStatistics();
      },
      
      // 渲染花朵排名
      renderFlowerRanking() {
        const { flowerRanking } = elements;
        
        if (appData.flowers.length === 0) {
          flowerRanking.innerHTML = '<p class="text-gray-500 text-center italic">暂无花朵数据</p>';
          return;
        }
        
        // 按浇水次数排序
        const sortedFlowers = [...appData.flowers].sort((a, b) => b.waterCount - a.waterCount);
        
        flowerRanking.innerHTML = '';
        
        sortedFlowers.forEach((flower, index) => {
          const rankEl = document.createElement('div');
          rankEl.className = 'p-3 bg-gray-50 rounded-md flex items-center';
          
          // 前三名显示奖牌
          let rankIndicator = '';
          if (index === 0) {
            rankIndicator = '<i class="fa fa-trophy text-yellow-500 mr-2"></i>';
          } else if (index === 1) {
            rankIndicator = '<i class="fa fa-trophy text-gray-400 mr-2"></i>';
          } else if (index === 2) {
            rankIndicator = '<i class="fa fa-trophy text-amber-700 mr-2"></i>';
          } else {
            rankIndicator = `<span class="w-6 inline-block text-center mr-2">${index + 1}</span>`;
          }
          
          rankEl.innerHTML = `
            <div class="mr-3">${rankIndicator}</div>
            <div class="flex-1">${flower.name}</div>
            <div class="font-semibold text-primary">${flower.waterCount} 次浇水</div>
          `;
          
          flowerRanking.appendChild(rankEl);
        });
      },
      
      // 渲染花圈统计
      renderWreathStatistics() {
        const { wreathStats } = elements;
        
        if (appData.wreaths.length === 0) {
          wreathStats.innerHTML = '<p class="text-gray-500 text-center italic">暂无花圈数据</p>';
          return;
        }
        
        wreathStats.innerHTML = '';
        
        appData.wreaths.forEach(wreath => {
          const statsEl = document.createElement('div');
          statsEl.className = 'p-3 bg-gray-50 rounded-md';
          
          // 计算总分数
          const totalScore = (wreath.scoreLogs || []).reduce((sum, log) => sum + log.score, 0);
          
          statsEl.innerHTML = `
            <div class="font-medium text-secondary mb-1">${wreath.name}</div>
            <div class="grid grid-cols-2 gap-2 text-sm">
              <div class="flex justify-between">
                <span class="text-gray-600">花朵数量:</span>
                <span>${wreath.flowers.length}</span>
              </div>
              <div class="flex justify-between">
                <span class="text-gray-600">总分数:</span>
                <span class="font-semibold">${totalScore}</span>
              </div>
            </div>
          `;
          
          wreathStats.appendChild(statsEl);
        });
      },
      
      // 设置事件监听器
      setupEventListeners() {
        // 导航切换
        elements.flowerBtn.addEventListener('click', () => {
          elements.flowerSection.classList.remove('hidden');
          elements.wreathSection.classList.add('hidden');
          elements.rankingSection.classList.add('hidden');
          
          elements.flowerBtn.classList.add('bg-primary/10', 'text-primary');
          elements.flowerBtn.classList.remove('bg-white', 'text-dark');
          
          elements.wreathBtn.classList.add('bg-white', 'text-dark');
          elements.wreathBtn.classList.remove('bg-primary/10', 'text-primary');
          
          elements.rankingBtn.classList.add('bg-white', 'text-dark');
          elements.rankingBtn.classList.remove('bg-primary/10', 'text-primary');
        });
        
        elements.wreathBtn.addEventListener('click', () => {
          elements.flowerSection.classList.add('hidden');
          elements.wreathSection.classList.remove('hidden');
          elements.rankingSection.classList.add('hidden');
          
          elements.flowerBtn.classList.add('bg-white', 'text-dark');
          elements.flowerBtn.classList.remove('bg-primary/10', 'text-primary');
          
          elements.wreathBtn.classList.add('bg-primary/10', 'text-primary');
          elements.wreathBtn.classList.remove('bg-white', 'text-dark');
          
          elements.rankingBtn.classList.add('bg-white', 'text-dark');
          elements.rankingBtn.classList.remove('bg-primary/10', 'text-primary');
        });
        
        elements.rankingBtn.addEventListener('click', () => {
          elements.flowerSection.classList.add('hidden');
          elements.wreathSection.classList.add('hidden');
          elements.rankingSection.classList.remove('hidden');
          
          elements.flowerBtn.classList.add('bg-white', 'text-dark');
          elements.flowerBtn.classList.remove('bg-primary/10', 'text-primary');
          
          elements.wreathBtn.classList.add('bg-white', 'text-dark');
          elements.wreathBtn.classList.remove('bg-primary/10', 'text-primary');
          
          elements.rankingBtn.classList.add('bg-primary/10', 'text-primary');
          elements.rankingBtn.classList.remove('bg-white', 'text-dark');
        });
        
        // 编辑员模态框
        elements.editorBtn.addEventListener('click', () => {
          if (appData.isEditor) {
            // 已登录，退出
            appData.isEditor = false;
            appData.saveData();
            this.updateEditorUI();
            this.renderWreathDetails();
          } else {
            // 未登录，显示模态框
            elements.editorModal.classList.remove('hidden');
            elements.editorPassword.value = '';
            elements.editorPassword.focus();
          }
        });
        
        elements.cancelEditorBtn.addEventListener('click', () => {
          elements.editorModal.classList.add('hidden');
        });
        
        elements.confirmEditorBtn.addEventListener('click', () => {
          const password = elements.editorPassword.value;
          if (appData.verifyEditorPassword(password)) {
            elements.editorModal.classList.add('hidden');
            this.updateEditorUI();
            this.renderWreathDetails();
          } else {
            alert('密码错误，请重试');
          }
        });
        
        // 花朵搜索
        elements.flowerSearch.addEventListener('input', () => {
          this.renderFlowerList();
        });
        
        // 添加新花
        elements.addFlowerBtn.addEventListener('click', () => {
          const newFlower = appData.addNewFlower();
          this.renderFlowerList();
          this.renderFlowerDetails();
          
          // 添加成长记录
          const currentFlower = appData.flowers.find(f => f.id === appData.currentFlowerId);
          if (currentFlower) {
            currentFlower.growthLog.push({
              action: '花朵创建',
              timestamp: new Date().toISOString()
            });
            appData.saveData();
            this.renderGrowthLog(currentFlower.growthLog);
          }
        });
        
        // 保存花朵名称
        elements.saveNameBtn.addEventListener('click', () => {
          const newName = elements.flowerName.value.trim();
          if (!newName) return;
          
          const currentFlower = appData.flowers.find(f => f.id === appData.currentFlowerId);
          if (currentFlower && currentFlower.name !== newName) {
            const oldName = currentFlower.name;
            currentFlower.name = newName;
            
            // 添加成长记录
            currentFlower.growthLog.push({
              action: `名称从 "${oldName}" 改为 "${newName}"`,
              timestamp: new Date().toISOString()
            });
            
            appData.saveData();
            this.renderFlowerList();
            this.renderFlowerDetails();
          }
        });
        
        // 浇花
        elements.waterBtn.addEventListener('click', () => {
          const currentFlower = appData.flowers.find(f => f.id === appData.currentFlowerId);
          if (currentFlower) {
            currentFlower.waterCount++;
            
            // 添加成长记录
            currentFlower.growthLog.push({
              action: '浇水一次',
              timestamp: new Date().toISOString()
            });
            
            appData.saveData();
            this.renderFlowerDetails();
            this.renderRankings();
            
            // 添加动画效果
            elements.flowerContainer.classList.add('grow-animation');
            setTimeout(() => {
              elements.flowerContainer.classList.remove('grow-animation');
            }, 500);
          }
        });
        
        // 删除花朵
        elements.deleteFlowerBtn.addEventListener('click', () => {
          if (confirm('确定要删除这朵花吗？此操作不可恢复。')) {
            appData.deleteFlower(appData.currentFlowerId);
            this.renderFlowerList();
            this.renderFlowerDetails();
            this.renderWreathDetails();
            this.renderRankings();
          }
        });
        
        // 添加花圈
        elements.addWreathBtn.addEventListener('click', () => {
          const name = elements.wreathName.value.trim();
          if (!name) {
            alert('请输入花圈名称');
            return;
          }
          
          appData.addNewWreath(name);
          elements.wreathName.value = '';
          this.renderWreathList();
          this.renderWreathDetails();
          this.renderRankings();
        });
        
        // 删除花圈
        elements.deleteWreathBtn.addEventListener('click', () => {
          if (confirm('确定要删除这个花圈吗？此操作不可恢复。')) {
            appData.deleteWreath(appData.currentWreathId);
            this.renderWreathList();
            this.renderWreathDetails();
            this.renderRankings();
          }
        });
        
        // 给花圈加分
        elements.addScoreToWreathBtn.addEventListener('click', () => {
          const score = parseInt(elements.wreathScoreToAdd.value);
          const dateTime = elements.scoreDateTime.value;
          
          if (!score || score <= 0) {
            alert('请输入有效的分数');
            return;
          }
          
          appData.addScoreToWreath(score, dateTime);
          elements.wreathScoreToAdd.value = '';
          elements.scoreDateTime.value = '';
          this.renderWreathDetails();
          this.renderRankings();
        });
        
        // 添加花朵到花圈
        elements.addFlowerToWreathBtn.addEventListener('click', () => {
          const flowerId = elements.flowerToAdd.value;
          if (!flowerId) {
            alert('请选择要添加的花');
            return;
          }
          
          if (appData.addFlowerToWreath(flowerId)) {
            this.renderWreathDetails();
            this.renderRankings();
          } else {
            alert('这朵花已经在花圈中了');
          }
        });
        
        // 点击模态框外部关闭
        elements.editorModal.addEventListener('click', (e) => {
          if (e.target === elements.editorModal) {
            elements.editorModal.classList.add('hidden');
          }
        });
        
        // 初始化日期时间为当前时间
        const now = new Date();
        // 格式化日期时间为本地ISO格式（YYYY-MM-DDThh:mm）
        const dateTimeStr = now.toISOString().slice(0, 16);
        elements.scoreDateTime.value = dateTimeStr;
      }
    };

    // 初始化应用
    document.addEventListener('DOMContentLoaded', () => {
      render.init();
    });
  </script>
</body>
</html>
